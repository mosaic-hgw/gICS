<!--
  ###license-information-start###
  gICS - a Generic Informed Consent Service
  __
  Copyright (C) 2014 - 2017 The MOSAIC Project - Institut fuer Community Medicine der
  							Universitaetsmedizin Greifswald - mosaic-projekt@uni-greifswald.de
  							concept and implementation
  							l. geidel
  							web client
  							g. weiher
  							a. blumentritt
  							please cite our publications
  							http://dx.doi.org/10.3414/ME14-01-0133
  							http://dx.doi.org/10.1186/s12967-015-0545-6
  __
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  ###license-information-end###
  -->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:jstl="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">

<body>
	<ui:composition template="/template/cm-template.xhtml">
		<ui:define name="navigationBar">
			<p:tabMenu activeIndex="5" styleClass="navigationBar">
				<p:menuitem value="#{msg['navigation.domain']}" url="domain.xhtml" />
				<p:menuitem value="#{msg['navigation.policy']}" url="policies.xhtml" />
				<p:menuitem value="#{msg['navigation.module']}" url="modules.xhtml" />
				<p:menuitem value="#{msg['navigation.template']}"
					url="consent-template.xhtml" />
				<p:menuitem value="#{msg['navigation.consent']}"
					url="consents.xhtml" />
				<p:menuitem value="#{msg['navigation.idSearch']}"
					url="id_search.xhtml" />
			</p:tabMenu>
		</ui:define>
		<ui:define name="navigationPanel">
			<h:form id="domain_form">
				<p:dataTable widgetVar="domain_navigation" var="domain"
					value="#{IdSearchController.domains}" rowKey="#{domain.name}"
					selectionMode="single"
					filteredValue="#{IdSearchController.filteredDomains}"
					styleClass="navigationTree">
					<p:ajax listener="#{IdSearchController.onDomainSelect}"
						event="rowSelect" update=":options_form:,:table_form:" />
					<f:facet name="header">
						<div align="center">#{msg['general.selectDomain']}</div>
						<p:separator />
						<div align="right">
							<p:outputPanel>
								<p:inputText id="globalFilter"
									onkeyup="PF('domain_navigation').filter();" style="width:150px" />
								<p:watermark for="globalFilter"
									value="#{msg['general.filterDomains']}"></p:watermark>

							</p:outputPanel>
						</div>
					</f:facet>
					<p:column filterBy="#{domain.label}" filterMatchMode="contains"
						filterStyle="display:none;">
								<h:outputText id="domain_display" title="#{domain.label}" value="#{domain.label}" converter="TrimConverter"/><br/>
								<h:outputText value="#{domain.name.equals(domain.label)?'':(domain.name)}" style=" opacity: 0.35;"/>
								<p:tooltip for="domain_display"></p:tooltip>
							</p:column>
				</p:dataTable>
			</h:form>
		</ui:define>
		<ui:define name="contentPanel">
			<h:form id="options_form">
				<p:focus context="options_form" />
					<h:outputText rendered="#{empty IdSearchController.selectedDomain}"
					value="#{msg['general.pleaseSelectDomain']}" />
					<p:outputPanel
					rendered="#{not empty IdSearchController.selectedDomain}">
					<h:outputText styleClass="headline" value="#{msg['idSearch.options']}" />
					<p:panel id="inputPanel" styleClass="noBackgroundColor">				
						<h:panelGrid columns="2" columnClasses="labelColumn,inputColumn">
							<p:outputLabel for="policy_name_input" value="#{msg['idSearch.policyName']}"/>
							<p:selectOneMenu required="true" id="policy_name_input" style="width:100%" value="#{IdSearchController.policy.name}" filter="true" filterMatchMode="startsWith">
								<f:selectItem noSelectionOption="true" itemLabel="please select" itemValue=""/>
								<f:selectItems value="#{IdSearchController.policyNames}" var="name" itemLabel="#{name}" itemValue="#{name}"  />
								<p:ajax process="@this" ignoreAutoUpdate="true" immediate="true" update="version_input"></p:ajax>
							</p:selectOneMenu>
							<!-- ****************************************************** -->
							<!-- <p:inputText id="policy_name_input" required="true" value="#{IdSearchController.policy.name}"></p:inputText>	 -->							
							<p:outputLabel for="version_input" value="#{msg['idSearch.policyVersion']}"/>
							<p:selectOneMenu disabled="#{empty IdSearchController.policy.name}" id="version_input" style="width:100%" value="#{IdSearchController.policy.version}">
								<f:selectItem noSelectionOption="true" itemLabel="any version" itemValue=""/>
								<f:selectItems value="#{IdSearchController.policyVersions}" var="name" itemLabel="version #{name}" itemValue="#{name}" />
							</p:selectOneMenu>
							<!-- ****************************************************** -->
							<p:spacer style="display:none"></p:spacer><p:spacer style="display:none"></p:spacer>
							<!-- ****************************************************** -->
							<!-- <p:inputText id="version_input" value="#{IdSearchController.policy.version}"></p:inputText>		 -->		
							<p:outputLabel for="id_type_select" value="#{msg['idSearch.searchFor']}"/>
							<p:selectOneMenu id="id_type_select" style="width:100%" required="true" value="#{IdSearchController.signerIdType}">
								<f:selectItem noSelectionOption="true" itemValue="" itemLabel="#{msg['idSearch.selectType']}"/>
								<f:selectItems value="#{IdSearchController.signerIdTypes}" var="id" itemLabel="#{id}" itemValue="#{id}"/>
							</p:selectOneMenu>
							<!-- ****************************************************** -->
							<p:outputLabel value="#{msg['idSearch.considerUnkownDeclined']}"/>
							<p:selectBooleanCheckbox value="#{IdSearchController.config.unknownStateIsConsideredAsDecline}"></p:selectBooleanCheckbox>
						</h:panelGrid>
						<p:watermark for="version_input" value="#{msg['idSearch.versionWatermark']}"></p:watermark>
						<div align="right" class="buttonBlock">
							<p:commandButton actionListener="#{IdSearchController.onApplyFilter}" value="#{msg['idSearch.startSearch']}" update=":table_form:">
							</p:commandButton>
							<p:commandButton value="#{msg['general.reset']}" actionListener="#{IdSearchController.refresh}" update="inputPanel,:table_form" process="@this">
								<p:resetInput target="inputPanel" />
							</p:commandButton>
						</div>

					</p:panel>
					</p:outputPanel>
			</h:form>
			<h:form id="table_form">
					<p:outputPanel
					rendered="#{not empty IdSearchController.selectedDomain}">
						<h:outputFormat styleClass="headline"   value="#{msg['idSearch.result']}" >
							<f:param value="#{empty IdSearchController.signerIdType?'Result':IdSearchController.signerIdType}"></f:param>
						</h:outputFormat>
					<p:dataTable var="signerId" value="#{IdSearchController.consentedIds}" styleClass="hideTableHeader"
						paginator="true" rows="10" paginatorAlwaysVisible="false"
						paginatorPosition="bottom"
						currentPageReportTemplate="Page {currentPage}({startRecord}-{endRecord} of {totalRecords})"
						paginatorTemplate=" {JumpToPageDropdown}  {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="10,20,30,40,50"
						rowKey="#{signerId}">
						<p:column>
							<h:outputText value="#{signerId}" />
						</p:column>
					</p:dataTable>
					<div class="buttonBlock" align="right">
						<p:commandButton disabled="#{empty IdSearchController.consentedIds}" actionListener="#{IdSearchController.handleFileDownload}" value="#{msg['idSearch.csvDownload']}" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);">
        					<p:fileDownload  value="#{IdSearchController.resultCsv}" />
   	 					</p:commandButton>
					</div>
					
					
					</p:outputPanel>
			</h:form>
		</ui:define>
	</ui:composition>
</body>
</html>
