<!--
  ###license-information-start###
  gICS - a Generic Informed Consent Service
  __
  Copyright (C) 2014 - 2017 The MOSAIC Project - Institut fuer Community Medicine der
  							Universitaetsmedizin Greifswald - mosaic-projekt@uni-greifswald.de
  							concept and implementation
  							l. geidel
  							web client
  							g. weiher
  							a. blumentritt
  							please cite our publications
  							http://dx.doi.org/10.3414/ME14-01-0133
  							http://dx.doi.org/10.1186/s12967-015-0545-6
  __
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  ###license-information-end###
  -->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:jstl="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui"
	xmlns:custom="http://java.sun.com/jsf/composite/ttp">

<body>
	<ui:composition template="/template/cm-template.xhtml">
		<ui:define name="navigationBar">
			<p:tabMenu activeIndex="0">
				<p:menuitem value="#{msg['navigation.domain']}" url="domain.xhtml" />
				<p:menuitem value="#{msg['navigation.policy']}" url="policies.xhtml" />
				<p:menuitem value="#{msg['navigation.module']}" url="modules.xhtml" />
				<p:menuitem value="#{msg['navigation.template']}"
					url="consent-template.xhtml" />
				<p:menuitem value="#{msg['navigation.consent']}"
					url="consents.xhtml" />
				<p:menuitem value="#{msg['navigation.idSearch']}"
					url="id_search.xhtml" />
			</p:tabMenu>
		</ui:define>
		<ui:define name="contentPanel">

			<h:form id="table_form">
				<p:outputPanel id="table_panel">
					<!-- rendered="#{not DomainController.tableDisabled}" -->
					<h:outputText styleClass="headline"
						value="#{msg['domain.tableHeader']}, #{msg['general.entriesFound']} #{DomainController.domains.size()}" />
					<p:dataTable selection="#{DomainController.selectedDomain}"
						selectionMode="single" rowKey="#{domain.name}" paginator="true"
						rows="10" paginatorAlwaysVisible="false"
						paginatorPosition="bottom"
						currentPageReportTemplate="Page {currentPage}({startRecord}-{endRecord} of {totalRecords})"
						paginatorTemplate=" {JumpToPageDropdown}  {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="10,20,30,40,50"
						value="#{DomainController.domains}" var="domain">
						<p:ajax event="rowSelect" update=":table_form:"></p:ajax>
						<p:column headerText="#{msg['domain.name']}">
			 				#{domain.label}<br />(#{domain.name})
			 			</p:column>
						<p:column headerText="#{msg['domain.comment']}">
			 				#{domain.comment}
			 			</p:column>
						<p:column headerText="#{msg['domain.versionFormatting']}">
								Policy: #{ClassPathProvider.convertClassPath(domain.policyVersionConverter)}<br />
			 					Module: #{ClassPathProvider.convertClassPath(domain.moduleVersionConverter)}<br />
			 					Template: #{ClassPathProvider.convertClassPath(domain.ctVersionConverter)}
			 				
			 			</p:column>
						<p:column headerText="#{msg['domain.signerTypes']}">
							<ui:repeat var="signerType" value="#{domain.signerIdTypes}"
								varStatus="status">
								<h:outputText value="#{signerType}" />
								<h:outputText rendered="#{not status.last}" value=", " />
							</ui:repeat>
						</p:column>
						<!-- 	<p:column headerText="#{msg['domain.ctVersionConverter']}">
			 				#{ClassPathProvider.convertClassPath(domain.ctVersionConverter)}
			 			</p:column>
						<p:column headerText="#{msg['domain.policyVersionConverter']}">
			 				#{ClassPathProvider.convertClassPath(domain.moduleVersionConverter)}
			 			</p:column>
						<p:column headerText="#{msg['domain.policyVersionConverter']}">
			 				#{ClassPathProvider.convertClassPath(domain.policyVersionConverter)}
			 			</p:column> -->
						<p:column headerText="#{msg['domain.properties']}">
							<ui:repeat value="#{jstl:split(domain.properties,';')}"
								var="property">
								<h:outputText value="#{property}" />
								<br />
							</ui:repeat>
						</p:column>
					</p:dataTable>
					<div align="right" class="buttonBlock">
						<p:commandButton update="@form,:create_form:"
							value="#{msg['domain.add']}"
							actionListener="#{DomainController.onNewDomain}"></p:commandButton>
						<p:commandButton
							disabled="#{not DomainController.domains.contains(DomainController.selectedDomain)}"
							update=":create_form:" value="#{msg['domain.update']}"
							actionListener="#{DomainController.onEditDomain}"></p:commandButton>
						<p:commandButton
							disabled="#{not DomainController.domains.contains(DomainController.selectedDomain)}"
							update="@form" value="#{msg['domain.delete']}"
							actionListener="#{DomainController.onDeleteDomain}">
							<p:confirm header="#{msg['domain.delete']}"
								message="#{msg['domain.confirmDelete']}">
							</p:confirm>
						</p:commandButton>
						<p:separator styleClass="verticalSeparator"></p:separator>
						<p:commandButton value="#{msg['general.refresh']}"
							actionListener="#{DomainController.refresh()}" update="@all"></p:commandButton>
					</div>
				</p:outputPanel>
			</h:form>
			<h:form id="create_form">
				<p:outputPanel
					rendered="#{not empty DomainController.selectedDomain}">
					<p:spacer style="height:10px;width:100%"></p:spacer>
					<h:outputText
						value="#{DomainController.editMode? msg['domain.editDomain']:msg['domain.newDomain']}"
						styleClass="headline" />
					<p:panel styleClass="noBackgroundColor">
						<h:outputText value="#{msg.general}" />
						<p:panel>
							<h:panelGrid columns="2" columnClasses="labelColumn,inputColumn">
								<p:outputLabel value="#{msg['domain.name']}"
									for="domain_name_input"></p:outputLabel>
								<p:inputText id="domain_name_input"
									label="#{msg['domain.name']}" required="true"
									value="#{DomainController.selectedDomain.label}"></p:inputText>
								<p:outputLabel value="#{msg['domain.comment']}"></p:outputLabel>
								<h:panelGroup>
									<p:inputTextarea
										value="#{DomainController.selectedDomain.comment}"
										maxlength="255" counter="comment_counter"
										counterTemplate="#{msg['general.counterTemplate']}">
									</p:inputTextarea>
									<h:outputText id="comment_counter" />
									<p:spacer height="5px" width="100%"></p:spacer>
								</h:panelGroup>



								<p:outputLabel for="signer_input"
									value="#{msg['domain.signerTypes']}"></p:outputLabel>
								<h:panelGroup>
									<h:panelGrid columns="2" columnClasses="noStyle,helpColumn"
										style="border-collapse:collapse;">
										<p:inputText id="signer_input" required="true"
											style="width:100%;" value="#{DomainController.signerTypes}"></p:inputText>
										<custom:helpButton id="signer_help"
											helptext="#{msg['domain.signerHelp']}" show="true"></custom:helpButton>
									</h:panelGrid>
									<p:watermark value="#{msg['domain.signerWatermark']}"
										for="signer_input"></p:watermark>
								</h:panelGroup>
							</h:panelGrid>
						</p:panel>
						<p:spacer style="height:10px;width:100%"></p:spacer>
						<p:outputPanel rendered="#{not DomainController.editMode}">
							<h:outputText value="#{msg['domain.versionFormatting']}" />
							<p:panel>
								<h:panelGrid columns="2" columnClasses="labelColumn,inputColumn">
									<p:outputLabel value="#{msg['domain.ctVersionConverter']}"></p:outputLabel>
									<p:selectOneMenu style="width:100%"
										label="#{msg['domain.ctVersionConverter']}"
										widgetVar="ctVersion_select" id="ctversion_select"
										value="#{DomainController.selectedDomain.ctVersionConverter}"
										required="true">
										<f:selectItems value="#{ClassPathProvider.versionMap}" />
									</p:selectOneMenu>
									<p:outputLabel value="#{msg['domain.moduleVersionConverter']}"></p:outputLabel>
									<p:selectOneMenu style="width:100%"
										label="#{msg['domain.moduleVersionConverter']}"
										widgetVar="moduleVersion_select" id="moduleversion_select"
										value="#{DomainController.selectedDomain.moduleVersionConverter}"
										required="true">
										<f:selectItems value="#{ClassPathProvider.versionMap}" />
									</p:selectOneMenu>
									<p:outputLabel value="#{msg['domain.policyVersionConverter']}"></p:outputLabel>
									<p:selectOneMenu style="width:100%"
										label="#{msg['domain.policyVersionConverter']}"
										widgetVar="policyVersion_select" id="policyversion_select"
										value="#{DomainController.selectedDomain.policyVersionConverter}"
										required="true">
										<f:selectItems value="#{ClassPathProvider.versionMap}" />
									</p:selectOneMenu>
								</h:panelGrid>
							</p:panel>
							<p:spacer style="height:10px;width:100%"></p:spacer>
						</p:outputPanel>

						<h:outputText value="#{msg['domain.properties']}" />
						<p:panel>
							<h:dataTable styleClass="propertiesTable" var="property"
								value="#{DomainController.properties}"
								columnClasses="labelColumnBig,inputColumn">
								<h:column>
									<h:outputText value="#{property.label}:" />
								</h:column>
								<h:column>
									<p:inputText value="#{property.value}" />
								</h:column>
								<!-- <h:column>
										<p:button id="property_help" icon="ui-icon-help" styleClass="helpButton" />
										<p:tooltip for="property_help" showEvent="focus" hideEvent="blur" />
									</h:column> -->
							</h:dataTable>
						</p:panel>
						<p:spacer style="height:20px;width:100%"></p:spacer>
						<div align="right" class="buttonBlock">
							<p:commandButton
								value="#{DomainController.editMode? msg['domain.save']:msg['domain.newDomain']}"
								actionListener="#{DomainController.onSaveDomain()}"
								update="@form,:table_form:"></p:commandButton>
							<p:commandButton value="#{msg['general.cancel']}"
								actionListener="#{DomainController.refresh()}"
								update="@form,:table_form:" immediate="true">
								<p:confirm header="#{msg['general.cancel']}"
									icon="ui-icon-alert" message="#{msg['template.confirmCancel']}"></p:confirm>
							</p:commandButton>
						</div>
					</p:panel>
				</p:outputPanel>
			</h:form>
		</ui:define>
	</ui:composition>
</body>
</html>
